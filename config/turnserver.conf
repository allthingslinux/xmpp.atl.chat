# COTURN TURN/STUN Server Configuration for XMPP.atl.chat
# Secure, production-ready configuration

# ============================================================================
# LISTENING CONFIGURATION
# ============================================================================

# TURN listener port for UDP and TCP (Default: 3478)
listening-port=3478

# TURN listener port for TLS (Default: 5349)
tls-listening-port=5349

# Alternative listening port for UDP and TCP listeners (RFC 5780 support)
alt-listening-port=3479

# Alternative listening port for TLS and DTLS protocols
alt-tls-listening-port=5350

# ============================================================================
# RELAY CONFIGURATION
# ============================================================================

# Lower and upper bounds of the UDP relay endpoints (SAFE RANGE)
min-port=50000
max-port=50100

# Number of relay threads (auto-detect optimal)
# relay-threads=0

# ============================================================================
# AUTHENTICATION & SECURITY
# ============================================================================

# Use TURN REST API with shared secret (recommended for Prosody integration)
use-auth-secret

# Static authentication secret for TURN REST API
# This will be replaced by environment variable at runtime
static-auth-secret=${TURN_SECRET}

# Default realm
realm=${TURN_REALM}

# Server name for oAuth authentication
server-name=${TURN_DOMAIN}

# Use fingerprints in TURN messages
fingerprint

# Extra security with nonce value having limited lifetime (10 minutes)
stale-nonce=600

# ============================================================================
# LISTENER CONFIGURATION
# ============================================================================

# Explicitly bind to all interfaces for Docker
listening-ip=0.0.0.0
listening-ip=::1

# Relay interface configuration
relay-ip=0.0.0.0
relay-ip=::1

# External IP for relay (if behind NAT)
# external-ip=YOUR_PUBLIC_IP

# ============================================================================
# TLS/DTLS CONFIGURATION
# ============================================================================

# Certificate file (PEM format) - will be mounted from host
cert=/etc/ssl/certs/cert.pem

# Private key file (PEM format) - will be mounted from host
pkey=/etc/ssl/private/privkey.pem

# Allowed OpenSSL cipher list for TLS/DTLS connections
cipher-list=ECDHE+AESGCM:ECDHE+CHACHA20:DHE+AESGCM:DHE+CHACHA20:!aNULL:!MD5:!DSS

# Disable weak TLS versions (security)
# Note: These options may not be supported in all COTURN versions
# The cipher-list will enforce strong ciphers regardless

# ============================================================================
# NETWORK SECURITY
# ============================================================================

# Disallow peers on well-known broadcast addresses
no-multicast-peers

# Require authentication of STUN Binding request
secure-stun

# Mobility with ICE (MICE) specs support
mobility

# ============================================================================
# LOGGING & MONITORING
# ============================================================================

# Log to stdout for Docker container
log-file=stdout

# Simple log format (no rollover)
simple-log

# Enable full ISO-8601 timestamp in logs
new-log-timestamp

# ============================================================================
# CLI & ADMINISTRATION
# ============================================================================

# Disable CLI support (security)
no-cli

# ============================================================================
# PERFORMANCE & RESOURCE LIMITS
# ============================================================================

# Maximum allocation lifetime (1 hour)
max-allocate-lifetime=3600

# Channel lifetime (10 minutes)
channel-lifetime=600

# Permission lifetime (5 minutes)
permission-lifetime=300

# Maximum allocation timeout (60 seconds)
max-allocate-timeout=60

# ============================================================================
# COMPLIANCE & STANDARDS
# ============================================================================

# Enable RFC5780 (NAT behavior discovery) - DISABLED for security
# rfc5780

# Disable backward compatibility for security
# stun-backward-compatibility

# ============================================================================
# ENVIRONMENT VARIABLES
# ============================================================================
# The following values will be substituted from environment:
# - ${TURN_SECRET}: Authentication secret
# - ${TURN_REALM}: Authentication realm
# - ${TURN_DOMAIN}: Server domain name
