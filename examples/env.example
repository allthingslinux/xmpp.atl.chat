# Professional Prosody XMPP Server Environment Configuration
# Copy this file to .env and customize for your deployment

# ============================================================================
# BASIC CONFIGURATION
# ============================================================================

# Your XMPP domain (REQUIRED)
PROSODY_DOMAIN=example.com

# Administrator accounts (comma-separated)
PROSODY_ADMINS=admin@example.com,support@example.com

# ============================================================================
# MODULE CONFIGURATION (ORGANIZED BY SOURCE)
# ============================================================================

# Core modules - all modules shipped with Prosody (recommended: true)
# Includes required, autoloaded, and distributed modules
PROSODY_ENABLE_CORE=true

# Community security modules - stable third-party (recommended: true)
PROSODY_ENABLE_SECURITY=true

# Community beta modules - mostly stable with some edge cases (recommended: false)
PROSODY_ENABLE_BETA=false

# Community alpha/experimental modules - use with caution (recommended: false)
PROSODY_ENABLE_ALPHA=false

# ============================================================================
# MODERN AUTHENTICATION (BETA MODULES)
# ============================================================================

# Enable SASL2 (XEP-0388: Extensible SASL Profile)
PROSODY_ENABLE_SASL2=false

# Enable Bind2 (XEP-0386: Bind 2)
PROSODY_ENABLE_BIND2=false

# Fast authentication tokens (XEP-0484: Fast Authentication Streamlining Tokens)
PROSODY_SASL2_FAST_TOKENS=false

# SASL downgrade protection (XEP-0474: SASL SCRAM Downgrade Protection)
PROSODY_SASL_SSDP=true

# Instant stream resumption (XEP-0397: Instant Stream Resumption)
PROSODY_ENABLE_ISR=false

# ============================================================================
# USER EXPERIENCE ENHANCEMENTS
# ============================================================================

# Sync avatars between vCard and PEP (XEP-0084/0153)
PROSODY_AVATAR_SYNC=true

# Chat state filter timeout in seconds (XEP-0085)
PROSODY_CHATSTATE_TIMEOUT=300

# Respect message processing hints (XEP-0334)
PROSODY_RESPECT_NO_STORE=true
PROSODY_RESPECT_NO_COPY=true

# Enhanced vCard support (XEP-0054/0292)
PROSODY_VCARD4_SUPPORT=true
PROSODY_PROFILE_PEP=true

# ============================================================================
# COMPLIANCE AND STANDARDS
# ============================================================================

# Enable XMPP Compliance Suites 2023 (XEP-0479)
PROSODY_COMPLIANCE_2023=false

# Automatic compliance testing
PROSODY_COMPLIANCE_AUTO_TEST=false

# Service outage status notifications (XEP-0455)
PROSODY_SERVICE_OUTAGE_NOTIFICATIONS=false

# Enhanced server information (XEP-0128)
PROSODY_ENHANCED_SERVER_INFO=false

# External service discovery (XEP-0215)
PROSODY_ENABLE_EXTDISCO=false

# ============================================================================
# EXTERNAL SERVICES (for XEP-0215)
# ============================================================================

# STUN server configuration
PROSODY_STUN_HOST=stun.example.com
PROSODY_STUN_PORT=3478

# TURN server configuration
PROSODY_TURN_HOST=turn.example.com
PROSODY_TURN_PORT=3478
PROSODY_TURN_USERNAME=
PROSODY_TURN_PASSWORD=

# Server information fields
PROSODY_SERVER_DESCRIPTION=Professional XMPP Server
PROSODY_SERVER_LOCATION=Cloud
PROSODY_ADMIN_CONTACT=admin@example.com
PROSODY_OUTAGE_CONTACT=admin@example.com
PROSODY_STATUS_URL=https://status.example.com

# ============================================================================
# REGISTRATION SETTINGS
# ============================================================================

# Allow user registration (recommended: false for production)
PROSODY_ALLOW_REGISTRATION=false

# ============================================================================
# DATABASE CONFIGURATION
# ============================================================================

# Storage backend: sqlite or sql
PROSODY_STORAGE=sqlite

# Database settings (only for PROSODY_STORAGE=sql)
PROSODY_DB_DRIVER=PostgreSQL
PROSODY_DB_HOST=db
PROSODY_DB_PORT=5432
PROSODY_DB_NAME=prosody
PROSODY_DB_USER=prosody
PROSODY_DB_PASSWORD=secure_password_here

# Database connection pooling
PROSODY_DB_POOL_SIZE=5
PROSODY_DB_MAX_CONNECTIONS=20
PROSODY_DB_TIMEOUT=30

# ============================================================================
# PERFORMANCE SETTINGS
# ============================================================================

# Client connection rate limiting
PROSODY_C2S_RATE=10kb/s
PROSODY_C2S_BURST=25kb

# Server connection rate limiting
PROSODY_S2S_RATE=30kb/s
PROSODY_S2S_BURST=100kb

# Stanza size limits (XMPP Safeguarding Manifesto compliance)
PROSODY_C2S_STANZA_LIMIT=262144
PROSODY_S2S_STANZA_LIMIT=524288

# Garbage collection settings
PROSODY_GC_MODE=incremental
PROSODY_GC_THRESHOLD=150
PROSODY_GC_SPEED=500

# ============================================================================
# LOGGING CONFIGURATION
# ============================================================================

# Log level: debug, info, warn, error
PROSODY_LOG_LEVEL=info

# Log format: default or json
PROSODY_LOG_FORMAT=default

# ============================================================================
# SECURITY SETTINGS
# ============================================================================

# Anti-spam threshold (messages before action)
PROSODY_SPAM_THRESHOLD=3

# Spam notification recipient
PROSODY_SPAM_NOTIFICATION=admin@example.com

# Failed authentication threshold
PROSODY_FAILED_AUTH_THRESHOLD=5
PROSODY_FAILED_AUTH_WINDOW=300

# Maximum connections per IP
PROSODY_MAX_CONNECTIONS_PER_IP=10

# Firewall rate limiting
PROSODY_FIREWALL_C2S_RATE=10/60
PROSODY_FIREWALL_S2S_RATE=30/60

# ============================================================================
# MESSAGE ARCHIVE MANAGEMENT (MAM)
# ============================================================================

# Archive policy: always, never, roster
PROSODY_ARCHIVE_POLICY=roster

# Archive expiration: 1y, 6m, 90d, etc.
PROSODY_ARCHIVE_EXPIRE=1y

# Maximum results per archive query
PROSODY_ARCHIVE_MAX_RESULTS=50

# ============================================================================
# MULTI-USER CHAT (MUC) SETTINGS
# ============================================================================

# MUC log expiration
PROSODY_MUC_LOG_EXPIRE=1y

# MUC history message count
PROSODY_MUC_HISTORY=50

# Default MUC room visibility
PROSODY_MUC_DEFAULT_PUBLIC=false

# ============================================================================
# HTTP UPLOAD SETTINGS (if PROSODY_ENABLE_HTTP=true)
# ============================================================================

# Maximum file size in bytes (10MB = 10485760)
PROSODY_UPLOAD_SIZE_LIMIT=10485760

# File expiration in seconds (30 days = 2592000)
PROSODY_UPLOAD_EXPIRE=2592000

# ============================================================================
# PORT CONFIGURATION
# ============================================================================

# Client connections (C2S)
PROSODY_C2S_PORT=5222

# Server connections (S2S)
PROSODY_S2S_PORT=5269

# HTTP services (BOSH, WebSocket)
PROSODY_HTTP_PORT=5280

# HTTPS services
PROSODY_HTTPS_PORT=5281

# ============================================================================
# DEPLOYMENT PROFILES
# ============================================================================

# Docker Compose profiles to enable
# Available: sql, cache, monitoring, enterprise
COMPOSE_PROFILES=

# ============================================================================
# EXAMPLE CONFIGURATIONS
# ============================================================================

# Personal Server (1-50 users)
# PROSODY_STORAGE=sqlite
# PROSODY_ENABLE_OFFICIAL=true
# PROSODY_ENABLE_SECURITY=true
# PROSODY_ENABLE_BETA=false
# PROSODY_C2S_RATE=5kb/s
# PROSODY_C2S_BURST=15kb

# Community Server (50-500 users)
# PROSODY_STORAGE=sql
# PROSODY_ENABLE_OFFICIAL=true
# PROSODY_ENABLE_SECURITY=true
# PROSODY_ENABLE_BETA=true
# PROSODY_C2S_RATE=10kb/s
# PROSODY_C2S_BURST=25kb
# COMPOSE_PROFILES=sql,cache

# Enterprise Server (500+ users)
# PROSODY_STORAGE=sql
# PROSODY_ENABLE_OFFICIAL=true
# PROSODY_ENABLE_SECURITY=true
# PROSODY_ENABLE_BETA=true
# PROSODY_ENABLE_ALPHA=false
# PROSODY_C2S_RATE=50kb/s
# PROSODY_C2S_BURST=100kb
# PROSODY_LOG_FORMAT=json
# COMPOSE_PROFILES=sql,cache,monitoring,enterprise 