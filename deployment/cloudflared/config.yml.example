# Cloudflare Tunnel configuration for XMPP over HTTPS (WebSocket/BOSH)
# NOTE:
# - Standard XMPP TCP ports (5222, 5269, 5223, 5270) require Cloudflare Spectrum to proxy.
# - This config exposes only HTTP(S) endpoints (WebSocket/BOSH/admin/metrics) via Cloudflare Tunnel.

# Replace with your tunnel UUID
tunnel: ${CLOUDFLARE_TUNNEL_ID}
credentials-file: /etc/cloudflared/${CLOUDFLARE_TUNNEL_ID}.json

ingress:
  # WebSocket endpoint
  - hostname: ${PROSODY_DOMAIN}
    path: /xmpp-websocket
    service: http://xmpp-prosody:5280

  # BOSH endpoint
  - hostname: ${PROSODY_DOMAIN}
    path: /http-bind
    service: http://xmpp-prosody:5280

  # Admin UI (optional)
  - hostname: admin.${PROSODY_DOMAIN}
    service: http://xmpp-prosody:5280

  # Metrics (optional)
  - hostname: metrics.${PROSODY_DOMAIN}
    service: http://xmpp-prosody:5280

  # Default catch-all
  - service: http_status:404

